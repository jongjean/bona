<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Good Morning Bona</title>

    <!-- SEO / OG Tags (Injected by Deployer) -->
    <meta property="og:title" content="{{OG_TITLE}}">
    <meta property="og:description" content="{{OG_DESCRIPTION}}">
    <meta property="og:image" content="{{OG_IMAGE}}">
    <meta property="og:url" content="{{OG_URL}}">
    <meta property="og:type" content="website">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Fonts: Standard Selection -->
    <link
        href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- Refined Modern Aesthetics (v0.4 Light) --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: 'Noto Serif KR', serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 2rem;
        }

        .card-container {
            width: 100%;
            max-width: 420px;
            /* Tighter width for focus */
            background: #000;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .content-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .app-title {
            width: 100%;
            text-align: center;
            font-family: 'Dancing Script', cursive;
            /* Elegant & Light */
            color: #b8860b;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            margin-top: 0.5rem;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(184, 134, 11, 0.3);
        }

        .date-display {
            color: #b8860b;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 300;
            text-align: center;
            width: 100%;
        }

        .gospel-title {
            font-family: 'Noto Serif KR', serif;
            font-size: 1.3rem;
            font-weight: 700;
            line-height: 1.4;
            margin-bottom: 1.5rem;
            text-align: center;
            word-break: keep-all;
            color: #fff;
        }

        .gold-frame-container {
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .gold-frame {
            border: 2px solid #b8860b;
            /* Light 2px Border */
            padding: 4px;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(184, 134, 11, 0.2);
            width: 100%;
            max-width: 100%;
        }

        .gold-frame img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 2px;
            filter: contrast(1.05) brightness(1.05);
            cursor: pointer;
        }

        .section-label {
            width: 100%;
            text-align: center;
            color: #b8860b;
            font-size: 0.82rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-family: 'Noto Sans KR', sans-serif;
            margin-top: 1.5rem;
        }

        .meditation-body {
            font-family: 'Noto Serif KR', serif;
            font-size: 1rem;
            line-height: 1.9;
            margin-bottom: 2rem;
            white-space: pre-wrap;
            opacity: 0.95;
            text-align: center;
            color: #fff;
            padding: 0 0.5rem;
            width: 100%;
        }

        /* --- FIXED PRAYER BOX (No more 'Box Problem') --- */
        .prayer-text {
            font-family: 'Noto Serif KR', serif;
            font-style: italic;
            color: #cccccc;
            font-size: 0.95rem;
            margin-bottom: 2.5rem;
            line-height: 1.6;
            padding-top: 1.2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            width: 85%;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            outline: none;
            display: block;
            /* Ensure centering works */
        }

        /* Footer & Actions */
        /* Footer & Actions */
        .button-row {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            width: 100%;
            margin-bottom: 2px;
            /* Reduced from 1.5rem for tight fit */
            margin-top: 1rem;
        }

        .missa-link-btn,
        .subscribe-btn {
            flex: 1;
            max-width: 180px;
            padding: 0.6rem;
            border: 1px solid #b8860b;
            border-radius: 30px;
            color: #b8860b;
            text-decoration: none;
            font-size: 0.8rem;
            background: none;
            text-align: center;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
        }

        .footer {
            width: 100%;
            text-align: center;
            font-family: 'Dancing Script', cursive;
            color: #b8860b;
            font-size: 1.4rem;
            margin-bottom: 1rem;
        }

        .share-btn {
            width: 100%;
            background: none;
            border: 1px solid #b8860b;
            color: #b8860b;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 0.5rem;
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* Modals & Guides (Black & Gold Theme) */
        .modal-overlay.hidden {
            display: none;
        }

        /* ... existing modal styles ... */

        /* ... later on ... */

        .footer-buttons {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            /* Force Right Align */
            width: 100%;
            margin-top: 0;
            /* Remove top margin */
            padding-right: 5px;
            /* Slight padding from edge */
        }

        /* ... */

        .help-btn {
            background: transparent;
            border: 1px solid #b8860b;
            /* Permanent Gold Border */
            color: #b8860b;
            /* Permanent Gold Text */
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            margin-top: 0;
            /* Remove top margin */
            margin-left: auto;
            /* Push to right if in flex row */
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #1a1a1a;
            padding: 1.5rem 1.2rem;
            border-radius: 24px;
            text-align: center;
            max-width: 85%;
            width: 330px;
            /* Increased by another 10% */
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
            border: 1px solid #b8860b;
            color: #f0f0f0;
            max-height: 80vh;
            overflow-y: auto;
            margin: auto;
        }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 15px;
            background: none;
            border: none;
            color: #b8860b;
            font-size: 1.2rem;
            cursor: pointer;
            line-height: 1;
        }

        /* Help Modal Styles */
        .help-modal h3 {
            margin-bottom: 20px;
            color: #b8860b;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.0rem;
            /* Smaller */
            font-weight: normal;
            /* No Bold */
        }

        .help-section {
            text-align: left;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #333;
        }

        .help-section h4 {
            color: #ebd095;
            margin-bottom: 8px;
            font-size: 0.78rem;
            /* Reduced to fit single line */
            font-weight: normal;
            /* No Bold */
            font-family: 'Noto Sans KR', sans-serif;
            letter-spacing: -0.5px;
            /* Tighten */
        }

        .help-section ol {
            padding-left: 18px;
            font-size: 0.8rem;
            /* Smaller */
            line-height: 1.35;
            color: #ccc;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .help-section li {
            margin-bottom: 4px;
        }

        .help-section strong {
            color: #fff;
            font-weight: normal;
            /* No Bold */
        }

        .help-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #b8860b, transparent);
            margin: 15px 0;
            opacity: 0.5;
        }

        /* ... help-footer ... */

        /* Button inside Help Modal (Gold Theme) */
        .inquiry-trigger-btn {
            display: block;
            width: 100%;
            margin-top: 20px;
            background: transparent;
            border: 1px solid #b8860b;
            /* Gold Border */
            color: #b8860b;
            /* Gold Text */
            padding: 8px;
            /* Compact */
            border-radius: 8px;
            font-size: 0.85rem;
            /* Smaller */
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .inquiry-trigger-btn:hover {
            background: rgba(184, 134, 11, 0.1);
            /* Subtle Hover */
        }

        .help-footer {
            font-size: 0.88rem;
            /* Increased to max fit */
            color: #999;
            text-align: left;
            margin-top: 15px;
            padding: 10px;
            letter-spacing: -0.3px;
        }

        .help-footer p {
            margin: 5px 0;
        }

        .help-footer .signature {
            text-align: right;
            margin-top: 15px;
            font-weight: normal;
            /* Humble (not bold) */
            color: #888;
            /* Humble (gray, not gold) */
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.75rem;
            /* Smaller */
            letter-spacing: -0.2px;
        }

        .help-btn {
            background: transparent;
            border: 1px solid #b8860b;
            /* Permanent Gold Border */
            color: #b8860b;
            /* Permanent Gold Text */
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            cursor: pointer;
            margin-top: 0;
            /* Tight spacing */
            margin-left: auto;
            /* Push to right if in flex row */
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
        }

        .help-btn:hover {
            background: rgba(184, 134, 11, 0.1);
            /* Subtle background on hover */
        }

        /* ... Inquiry Modal Styles ... */

        .footer-buttons {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            /* Force Right Align */
            width: 100%;
            margin-top: 2px;
            /* Tight spacing */
            padding-right: 5px;
            /* Slight padding from edge */
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .image-modal img {
            max-width: 95%;
            max-height: 90%;
            object-fit: contain;
        }

        .hidden {
            display: none !important;
        }

        .kakao-guide {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background: #1a1a1a;
            border: 1px solid #b8860b;
            border-radius: 15px;
            padding: 15px;
            z-index: 2500;
            text-align: center;
            font-size: 0.85rem;
            color: #ccc;
            display: none;
        }
    </style>
</head>

<body>
    <!-- Modals -->
    <div id="imageModal" class="image-modal" onclick="this.style.display='none'">
        <img id="zoomedImage" src="" alt="Zoomed">
    </div>

    <div id="landingModal" class="modal-overlay hidden">
        <div class="modal-card">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ””</div>
            <h3 style="color: #b8860b; margin-bottom: 0.5rem; font-size: 1.2rem;">ë§¤ì¼ ì•„ì¹¨ ë¬µìƒì‹œ ë°›ê¸°</h3>
            <p style="margin-bottom: 1.8rem; line-height: 1.6; font-size: 0.9rem; color: #ccc;">
                ì •ì„±ê» ì¤€ë¹„í•œ ë§¤ì¼ë¯¸ì‚¬ ë¬µìƒì‹œì™€<br>ì¶•ë³µì˜ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
            </p>
            <button id="mainSubBtn" class="subscribe-btn"
                style="max-width: 100%; background: #b8860b; color: #fff; font-weight: bold; font-size: 1rem; padding: 0.8rem;">
                ì§€ê¸ˆ êµ¬ë… ì‹ ì²­í•˜ê¸°
            </button>
            <button onclick="closeLandingModal()"
                style="margin-top: 1.2rem; background: none; border: none; color: #666; font-size: 0.85rem; cursor: pointer; text-decoration: underline;">
                ë‚˜ì¤‘ì— í• ê²Œìš” (ì˜¤ëŠ˜ ì¹´ë“œ ë³´ê¸°)
            </button>
        </div>
    </div>

    <!-- Kakao Guide (Polite Modal) -->
    <div id="kakaoGuide" class="modal-overlay hidden" onclick="if(event.target === this) this.classList.add('hidden')">
        <div class="modal-card" style="border-color: #b8860b; padding: 2.2rem 1.5rem;">
            <div style="font-size: 2.5rem; margin-bottom: 1.2rem;">âœ </div>
            <h3 style="color: #b8860b; margin-bottom: 1rem; font-size: 1.1rem; line-height: 1.5;">ì•Œë¦¼ ì„¤ì • ì œì•½ ì•ˆë‚´</h3>
            <p style="margin-bottom: 1.8rem; line-height: 1.7; font-size: 0.9rem; color: #eee; word-break: keep-all;">
                ì£„ì†¡í•©ë‹ˆë‹¤. ì¹´ì¹´ì˜¤í†¡ ì•ˆì—ì„œëŠ”<br>ì‹œìŠ¤í…œ ì œì•½ìœ¼ë¡œ ì•Œë¦¼ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>
                ë²ˆê±°ë¡œìš°ì‹œê² ì§€ë§Œ <strong>ì•„ë˜ ë°©ë²•</strong>ìœ¼ë¡œ<br>êµ¬ë…ì„ ì™„ë£Œí•´ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
            </p>

            <div
                style="background: rgba(184, 134, 11, 0.1); border: 1px dashed #b8860b; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; text-align: left;">
                <p style="font-size: 0.85rem; color: #fff; line-height: 1.7;">
                    1. í™”ë©´ì„ ì•„ë˜ë¡œ <strong>ì‚´ì§ ì“¸ì–´ë‚´ë¦¬ê¸°</strong><br>
                    2. ìš°ì¸¡ í•˜ë‹¨ <strong>ì„¸ë¡œ ì  3ê°œ(â‹®)</strong> í´ë¦­<br>
                    3. <strong>[ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°]</strong> ì„ íƒ
                </p>
            </div>

            <button onclick="document.getElementById('kakaoGuide').classList.add('hidden')"
                style="width: 100%; background: #b8860b; color: #fff; border: none; padding: 0.8rem; border-radius: 30px; font-size: 0.9rem; font-weight: bold; cursor: pointer;">
                í™•ì¸í–ˆìŠµë‹ˆë‹¤
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="card-container">
        <div class="content-wrapper">
            <div class="app-title">Good Morning Bona</div>

            <div id="contentState" style="width: 100%;">
                <div id="dateDisplay" class="date-display"></div>
                <div id="gospelTitle" class="gospel-title"></div>

                <div class="gold-frame-container">
                    <div class="gold-frame">
                        <img id="meditationImage" src="" alt="Meditation" onclick="openImageModal(this.src)">
                    </div>
                </div>

                <div class="section-label">ë¬µìƒì‹œ</div>
                <div id="meditationBody" class="meditation-body"></div>

                <div class="section-label">
                    í™”ì‚´ê¸°ë„ <span style="font-size: 0.7rem; color: #888; font-weight: 400; margin-left: 5px;">{ë‚˜ì˜ ê¸°ë„ë¡œ ìˆ˜ì • ì „ë‹¬
                        ê°€ëŠ¥}</span>
                </div>
                <div id="prayerText" class="prayer-text" contenteditable="true" spellcheck="false" data-original="">
                </div>
                <!-- Share Button Moved Here (Below Prayer) -->
                <button id="shareBtn" class="share-btn" style="margin-top: 15px; margin-bottom: 5px;">ì „ë‹¬í•˜ê¸°</button>
            </div>
        </div>

        <div class="button-row">
            <a href="https://missa.cbck.or.kr/DailyMissa" target="_blank" class="missa-link-btn">ë§¤ì¼ë¯¸ì‚¬ ì „ë¬¸ ë³´ê¸°</a>
            <button id="cardSubBtn" class="subscribe-btn">êµ¬ë… ì‹ ì²­</button>
        </div>

        <!-- Help Button Moved Here (Below Subscribe Line) -->
        <div class="footer-buttons">
            <button id="helpBtn" class="help-btn">êµ¬ë…ì‹ ì²­ ì•ˆë ë•Œ</button>
        </div>

        <div class="footer">Bona Studio</div>

        <!-- Small Inquiry Button (Footer) -->
        <button id="footerInquiryBtn"
            style="background: none; border: none; color: #555; font-size: 0.7rem; margin-top: 15px; text-decoration: underline; cursor: pointer; padding-bottom: 10px; font-family: 'Noto Sans KR', sans-serif;">
            ë³´ë‚˜ì—ê²Œ ë¬¸ì˜ í™”ì‚´ ì˜ê¸°
        </button>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal-overlay hidden">
        <div class="modal-content help-modal">
            <button class="close-btn"
                onclick="document.getElementById('helpModal').classList.add('hidden')">&times;</button>
            <h3>êµ¬ë…ì‹ ì²­ ì•ˆë ë•Œ ë°©ë²•ì•ˆë‚´</h3>
            <div class="help-section">
                <h4>ë„¤ì´ë²„/ì¹´ì¹´ì˜¤í†¡ì€ â€˜êµ¬ë…ì‹ ì²­â€™ ë²„íŠ¼ì´ ì˜ ì•ˆë©ë‹ˆë‹¤.</h4>
                <ol>
                    <li>ë¬µìƒì¹´ë“œ í™”ë©´ì„ ì“¸ì–´ ë‚´ë ¤ â€˜â‹®â€™ í´ë¦­</li>
                    <li><strong>ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì—´ê¸°</strong><br>(í¬ë¡¬ì´ë‚˜ ì‚¼ì„± í™”ë©´ìœ¼ë¡œ ì—´ë¦¬ë‹ˆ ë‹¤ì‹œ ì‹œë„í•˜ì…”ìš”.)</li>
                </ol>
            </div>
            <div class="help-divider"></div>
            <div class="help-section">
                <h4>í˜¹ì‹œ â€˜ì•Œë¦¼ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”â€™ ê²½ê³ ì°½ì´ ë‚˜ì˜¬ì‹œ</h4>
                <ol>
                    <li>ìƒë‹¨ ì£¼ì†Œì°½ ì¢Œì¸¡ <strong>ìë¬¼ì‡  ì•„ì´ì½˜</strong> í´ë¦­</li>
                    <li><strong>ì•Œë¦¼ ì¼œê¸°(í—ˆìš©)</strong> &gt; í™•ì¸</li>
                    <li>ë‹¤ì‹œ ì‹œë„í•˜ì‹­ì‹œì˜¤</li>
                </ol>
            </div>
            <div class="help-footer">
                <p>* êµ¬ë…ì‹ ì²­ ì¦‰ì‹œ ì²« ë¬µìƒì¹´ë“œê°€ ë‚ ì•„ì˜µë‹ˆë‹¤.</p>
                <p>* í° ìƒë‹¨ì„ ì“¸ì–´ë‚´ë¦¬ë©´ ì•Œë¦¼ì´ ì™€ ìˆìŠµë‹ˆë‹¤.</p>
                <p>* ë§¤ì¼ ì•„ì¹¨ 6ì‹œì— ë¬µìƒì¹´ë“œê°€ ë„ì°©í•©ë‹ˆë‹¤.</p>
                <br>
                <p class="signature">ìš´ì˜ì ë³´ë‚˜ë²¤ëšœë¼ ë“œë¦¼</p>
                <button id="inquiryBtn" class="inquiry-trigger-btn">ë³´ë‚˜ì—ê²Œ ë¬¸ì˜ í™”ì‚´ì˜ê¸° ğŸ¹</button>
            </div>
        </div>
    </div>

    <!-- Inquiry Modal -->
    <div id="inquiryModal" class="modal-overlay hidden">
        <div class="modal-content inquiry-modal" style="width: 330px; font-family: 'Noto Sans KR', sans-serif;">
            <button class="close-btn"
                onclick="document.getElementById('inquiryModal').classList.add('hidden')">&times;</button>
            <h3 style="margin-bottom: 20px; color: #b8860b; font-size: 1.0rem; font-weight: normal;">ë³´ë‚˜ì—ê²Œ ë¬¸ì˜ í™”ì‚´ì˜ê¸°</h3>
            <p class="inquiry-desc" style="color: #ccc; font-size: 0.85rem; margin-bottom: 15px; line-height: 1.4;">ë¬¸ì˜
                ë‚´ìš©ì„ ì ì–´ ë³´ë‚´ì£¼ì‹œë©´ ìš´ì˜ìì—ê²Œ<br>ì•Œë¦¼ì´ ê°‘ë‹ˆë‹¤.</p>
            <div class="inquiry-form">
                <textarea id="inquiryMessage" placeholder="ë¬¸ì˜í•˜ì‹¤ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..." rows="5"
                    style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #555; border-radius: 8px; color: #fff; padding: 10px; font-size: 0.85rem; font-family: 'Noto Sans KR', sans-serif; resize: none; margin-bottom: 10px;"></textarea>
                <input type="text" id="inquiryContact" placeholder="ë‹µë³€ ë°›ì„ ì´ë©”ì¼ ë˜ëŠ” ì—°ë½ì²˜ (ì„ íƒì‚¬í•­)"
                    style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #555; border-radius: 8px; color: #fff; padding: 10px; font-size: 0.85rem; font-family: 'Noto Sans KR', sans-serif; margin-bottom: 15px;">
                <p class="inquiry-note" style="font-size: 0.8rem; color: #999; margin-bottom: 15px; line-height: 1.4;">*
                    êµ¬ë…ì¤‘ì´ì‹œë©´ í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ ë‹µì¥ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
                <button id="sendInquiryBtn" class="send-btn"
                    style="width: 100%; background: transparent; border: 1px solid #b8860b; color: #b8860b; padding: 8px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; font-family: 'Noto Sans KR', sans-serif;">í™”ì‚´
                    ì˜ê¸° (ì „ì†¡)</button>
            </div>
        </div>
    </div>

    <!-- Reply Received Modal (New) -->
    <div id="replyModal" class="modal-overlay hidden">
        <div class="modal-content inquiry-modal" style="width: 330px; font-family: 'Noto Sans KR', sans-serif;">
            <button class="close-btn"
                onclick="document.getElementById('replyModal').classList.add('hidden')">&times;</button>
            <h3 style="margin-bottom: 20px; color: #b8860b; font-size: 1.0rem; font-weight: normal;">ğŸ’Œ ë³´ë‚˜ë²¤ëšœë¼ì˜ ë‹µì¥</h3>
            <div id="replyContent"
                style="background: rgba(255,255,255,0.05); border: 1px solid #b8860b; border-radius: 12px; padding: 15px; color: #fff; font-size: 0.9rem; line-height: 1.6; text-align: left; white-space: pre-wrap; margin-bottom: 20px;">
            </div>

            <!-- User Reply Section -->
            <div style="margin-bottom: 15px;">
                <textarea id="replyReplyMessage" placeholder="ì¶”ê°€ ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..."
                    style="width: 100%; height: 80px; background: #333; color: #fff; border: 1px solid #555; padding: 10px; border-radius: 8px; font-size: 0.9rem; resize: none; font-family: 'Noto Sans KR', sans-serif;"></textarea>
                <button id="replyReplyBtn"
                    style="width: 100%; background: #444; color: #fff; border: 1px solid #666; padding: 8px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; margin-top: 5px; font-family: 'Noto Sans KR', sans-serif;">
                    ë‹µì¥ ë³´ë‚´ê¸°
                </button>
            </div>

            <button onclick="document.getElementById('replyModal').classList.add('hidden')"
                style="width: 100%; background: #b8860b; color: #000; border: none; padding: 10px; border-radius: 8px; font-size: 0.9rem; font-weight: bold; cursor: pointer; font-family: 'Noto Sans KR', sans-serif;">
                í™•ì¸í–ˆìŠµë‹ˆë‹¤ (ë‹«ê¸°)
            </button>
        </div>
    </div>

    <!-- KakaoTalk In-App Browser Auto Redirect Script -->
    <!-- KakaoTalk In-App Browser Auto Redirect Script -->
    <script>
        // [Verified] Only redirect on INTERACTION to prevent blank screen issues
        window.addEventListener('DOMContentLoaded', function () {
            if (navigator.userAgent.match(/KAKAOTALK/i)) {
                // Determine if we should redirect
                const isAndroid = navigator.userAgent.match(/Android/i);

                if (isAndroid) {
                    let redirected = false;
                    const doRedirect = function (e) {
                        if (redirected) return;
                        // Don't redirect if interacting with buttons/inputs
                        if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.closest('button')) return;

                        redirected = true;
                        const currentUrl = location.href;
                        const intentUrl = 'intent:' + currentUrl.replace(/https?:\/\//i, '') + '#Intent;scheme=https;package=com.android.chrome;end;';
                        location.href = intentUrl;
                    };

                    // Trigger on click, touch, or drag (scroll)
                    ['click', 'touchstart', 'touchmove'].forEach(evt =>
                        document.body.addEventListener(evt, doRedirect, { capture: true })
                    );
                }
            }
        });
    </script>

    <script>
        // --- BAKE POINT ---
        const BONA_DATA = {{ BONA_DATA_JSON }};

        // --- Reply Check Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const replyMsg = urlParams.get('reply_msg');

            if (replyMsg) {
                document.getElementById('replyContent').textContent = decodeURIComponent(replyMsg);
                document.getElementById('replyModal').classList.remove('hidden');

                // Clean URL
                const newUrl = window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
            }
        });

        // --- RENDER ---
        function initContent() {
            const urlParams = new URLSearchParams(window.location.search);
            const customPrayer = urlParams.get('p') || urlParams.get('prayer');
            const targetDate = urlParams.get('date');

            if (!BONA_DATA) return;

            // Archive Redirection
            const isIndex = window.location.pathname.endsWith('index.html') || window.location.pathname.endsWith('/bona/');
            if (isIndex && targetDate && targetDate !== BONA_DATA.date) {
                window.location.href = `./${targetDate}.html` + window.location.search;
                return;
            }

            if (BONA_DATA.date) {
                const dateParts = BONA_DATA.date.split('-');
                document.getElementById('dateDisplay').textContent = `âœ  ê°€í†¨ë¦­ ë§¤ì¼ì•„ì¹¨ ë§¤ì¼ë¯¸ì‚¬ ë³µìŒë¬µìƒ ${dateParts[0]}. ${dateParts[1]}. ${dateParts[2]}.`;
            }

            document.getElementById('gospelTitle').textContent = BONA_DATA.one_line_message || '';
            document.getElementById('meditationBody').textContent = BONA_DATA.meditation_body || '';

            const prayerEl = document.getElementById('prayerText');
            if (customPrayer) {
                prayerEl.textContent = decodeURIComponent(customPrayer).replace(/_/g, ' ');
                prayerEl.style.color = "#ebd095";
            } else {
                prayerEl.textContent = BONA_DATA.prayer_line || '- Bona Studio -';
            }
            prayerEl.setAttribute('data-original', BONA_DATA.prayer_line || '');

            if (BONA_DATA.generated_image_url) {
                let imgUrl = BONA_DATA.generated_image_url;
                if (imgUrl.includes('/uploads/')) imgUrl = './uploads/' + imgUrl.split('/uploads/')[1];
                document.getElementById('meditationImage').src = imgUrl;
            }
        }

        function openImageModal(src) {
            document.getElementById('zoomedImage').src = src;
            document.getElementById('imageModal').style.display = 'flex';
        }

        function closeLandingModal() {
            document.getElementById('landingModal').classList.add('hidden');
            // [ì •ìƒí™”] ì‚¬ìš©ì ë°°ë ¤ë¥¼ ìœ„í•´ 24ì‹œê°„ì—ì„œ 72ì‹œê°„ìœ¼ë¡œ ì•ˆë³´ê¸° ìœ ì˜ˆ ì—°ì¥
            localStorage.setItem('bona_modal_dismissed', new Date().toISOString());
        }

        async function subscribeUser() {
            if (!('serviceWorker' in navigator)) return alert('ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
            try {
                const reg = await navigator.serviceWorker.register('./sw.js', { scope: './' });
                const permission = await Notification.requestPermission();
                if (permission !== 'granted') return alert('ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');

                const keyRes = await fetch('/bona/api/vapid-key');
                const { publicKey } = await keyRes.json();

                const sub = await reg.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: urlBase64ToUint8Array(publicKey)
                });

                await fetch('/bona/api/subscribe', {
                    method: 'POST',
                    body: JSON.stringify(sub),
                    headers: { 'Content-Type': 'application/json' }
                });

                localStorage.setItem('bona_subscribed', 'true');

                // ëª¨ë“  êµ¬ë… ê´€ë ¨ ë²„íŠ¼ ìƒíƒœ ë™ê¸°í™”
                const subBtns = ['cardSubBtn', 'mainSubBtn'];
                subBtns.forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        btn.textContent = 'êµ¬ë… ì™„ë£Œ';
                        btn.disabled = true;
                    }
                });

                alert('âœ… êµ¬ë… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeLandingModal();
            } catch (e) {
                console.error(e);

                if (navigator.userAgent.includes('KAKAOTALK')) {
                    // ì¹´í†¡ì—ì„œëŠ” ì—ëŸ¬ ì•Œë¦¼ ëŒ€ì‹  ì „ìš© ì•ˆë‚´ ëª¨ë‹¬ ë…¸ì¶œ
                    document.getElementById('kakaoGuide').classList.remove('hidden');
                    return;
                }

                if (localStorage.getItem('bona_subscribed') === 'true') {
                    alert('ì´ë¯¸ êµ¬ë… ì‹ ì²­ì´ ì™„ë£Œëœ ìƒíƒœì…ë‹ˆë‹¤. ë§¤ì¼ ì•„ì¹¨ ì°¾ì•„ëµ™ê² ìŠµë‹ˆë‹¤. âœ ');
                    closeLandingModal();
                } else {
                    alert('ì—°ê²°ì´ ì›í™œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            }
        }

        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            for (let i = 0; i < rawData.length; ++i) { outputArray[i] = rawData.charCodeAt(i); }
            return outputArray;
        }

        async function share() {
            const prayerEl = document.getElementById('prayerText');
            const currentPrayer = prayerEl.textContent.trim();
            const originalPrayer = (prayerEl.getAttribute('data-original') || '').trim();

            // [Modified] Use Static .html for cleaner links & dynamic OG Tags
            const date = BONA_DATA ? BONA_DATA.date : new Date().toISOString().split('T')[0];
            let finalUrl = `https://uconai.ddns.net/bona/${date}.html`;

            // Build query params
            const params = new URLSearchParams();
            if (currentPrayer && currentPrayer !== originalPrayer && currentPrayer !== '- Bona Studio -') {
                params.set('prayer', currentPrayer);
            }
            const paramStr = params.toString();
            if (paramStr) finalUrl += `?${paramStr}`;

            try {
                if (navigator.share) {
                    await navigator.share({
                        title: 'Good Morning Bona',
                        text: `(ê°€í†¨ë¦­) ë§¤ì¼ì•„ì¹¨ ë§¤ì¼ë¯¸ì‚¬ ë³µìŒë¬µìƒ\n\n"${currentPrayer}"`,
                        url: finalUrl
                    });
                } else {
                    await navigator.clipboard.writeText(finalUrl);
                    alert('ì¹´ë“œ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”. ğŸ’Œ');
                }
            } catch (e) {
                console.error(e);
                try {
                    await navigator.clipboard.writeText(finalUrl);
                    alert('ì¹´ë“œ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ’Œ');
                } catch (err) { }
            }
        }

        window.addEventListener('DOMContentLoaded', async () => {
            initContent();

            // [Fix] ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆëŠ” ë¬´ì¡°ê±´ ìµœìš°ì„  ë“±ë¡ (UI ë°˜ì‘ì„± ë³´ì¥)
            const mainSubBtn = document.getElementById('mainSubBtn');
            const cardSubBtn = document.getElementById('cardSubBtn');
            const shareBtn = document.getElementById('shareBtn');

            if (mainSubBtn) mainSubBtn.addEventListener('click', subscribeUser);
            if (cardSubBtn) cardSubBtn.addEventListener('click', subscribeUser);
            if (shareBtn) shareBtn.addEventListener('click', share);

            // Help & Inquiry Buttons
            const helpBtn = document.getElementById('helpBtn');
            const inquiryBtn = document.getElementById('inquiryBtn');
            const sendInquiryBtn = document.getElementById('sendInquiryBtn');

            if (helpBtn) helpBtn.addEventListener('click', () => {
                document.getElementById('helpModal').classList.remove('hidden');
            });
            if (inquiryBtn) inquiryBtn.addEventListener('click', () => {
                document.getElementById('inquiryModal').classList.remove('hidden');
            });
            // Footer Inquiry Button
            const footerInquiryBtn = document.getElementById('footerInquiryBtn');
            if (footerInquiryBtn) footerInquiryBtn.addEventListener('click', () => {
                document.getElementById('inquiryModal').classList.remove('hidden');
            });

            // Send Inquiry Logic
            if (sendInquiryBtn) sendInquiryBtn.addEventListener('click', async () => {
                const msg = document.getElementById('inquiryMessage').value.trim();
                const contact = document.getElementById('inquiryContact').value.trim();
                if (!msg) return alert('ë¬¸ì˜ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

                const btn = document.getElementById('sendInquiryBtn');
                btn.disabled = true; btn.textContent = 'ì „ì†¡ ì¤‘...';

                try {
                    // [Upgrade] Check & Try Subscription before sending
                    let sub = null;
                    const isKakao = navigator.userAgent.includes('KAKAOTALK');

                    // Skip complex subscription logic for KakaoTalk to avoid errors
                    if (!isKakao && 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window) {
                        try {
                            const reg = await navigator.serviceWorker.getRegistration();
                            if (reg) {
                                sub = await reg.pushManager.getSubscription();
                                if (!sub) {
                                    // 1. Permission Check & Request
                                    if (Notification.permission === 'default') {
                                        const allow = confirm('ë‹µë³€ ì•Œë¦¼ì„ ë°›ìœ¼ì‹œë ¤ë©´ ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.\nê¶Œí•œì„ í—ˆìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                                        if (allow) {
                                            const perm = await Notification.requestPermission();
                                            if (perm === 'granted') {
                                                // Try to subscribe again (Dynamic Key Fetch)
                                                try {
                                                    const keyRes = await fetch('/bona/api/vapid-key');
                                                    const { publicKey } = await keyRes.json();

                                                    sub = await reg.pushManager.subscribe({
                                                        userVisibleOnly: true,
                                                        applicationServerKey: urlBase64ToUint8Array(publicKey)
                                                    });
                                                } catch (e) { console.error('[Sub Retry Failed]', e); }
                                            }
                                        }
                                    }

                                    // 2. If blocked or denied
                                    else if (Notification.permission === 'denied') {
                                        // Just warn once, don't block
                                        if (!confirm('ì•Œë¦¼ ê¶Œí•œì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹µë³€ ì•Œë¦¼ ì—†ì´ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                                            btn.disabled = false; btn.textContent = 'í™”ì‚´ ì˜ê¸° (ì „ì†¡)';
                                            return;
                                        }
                                    }
                                }
                            }
                        } catch (e) {
                            console.warn('SW/Push check failed:', e);
                        }
                    }

                    // For Kakao or failed sub, prompt if needed (but lighter)
                    if (!sub && !isKakao && 'Notification' in window && Notification.permission !== 'granted') {
                        // Double check just in case
                        if (!confirm('ì•Œë¦¼ ê¶Œí•œì´ ì—†ì–´ ë‹µë³€ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nê·¸ë˜ë„ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            btn.disabled = false; btn.textContent = 'í™”ì‚´ ì˜ê¸° (ì „ì†¡)';
                            return;
                        }
                    }

                    await fetch('/bona/api/inquiry', {
                        method: 'POST',
                        body: JSON.stringify({ message: msg, contact, subscription: sub }),
                        headers: { 'Content-Type': 'application/json' }
                    });

                    alert('í™”ì‚´(ë¬¸ì˜)ì´ ì„±ê³µì ìœ¼ë¡œ ë‚ ì•„ê°”ìŠµë‹ˆë‹¤! \nìš´ì˜ìê°€ í™•ì¸ í›„ ë‹µì¥ì„ ë“œë¦´ ê²ƒì…ë‹ˆë‹¤.');
                    document.getElementById('inquiryMessage').value = '';
                    document.getElementById('inquiryModal').classList.add('hidden');
                } catch (e) {
                    alert('ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    console.error(e);
                } finally {
                    btn.disabled = false; btn.textContent = 'í™”ì‚´ ì˜ê¸° (ì „ì†¡)';
                }
            });

            // [New] Reply to Admin from Modal
            const replyReplyBtn = document.getElementById('replyReplyBtn');
            if (replyReplyBtn) replyReplyBtn.addEventListener('click', async () => {
                const msgEl = document.getElementById('replyReplyMessage');
                const msg = msgEl.value.trim();
                if (!msg) return alert('ë‹µë³€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

                replyReplyBtn.disabled = true; replyReplyBtn.textContent = 'ì „ì†¡ ì¤‘...';

                try {
                    let sub = null;
                    try {
                        const reg = await navigator.serviceWorker.getRegistration();
                        if (reg) sub = await reg.pushManager.getSubscription();
                    } catch (e) { }

                    await fetch('/bona/api/inquiry', {
                        method: 'POST',
                        body: JSON.stringify({ message: `[ë‹µì¥] ${msg}`, contact: 'Re:Reply', subscription: sub }),
                        headers: { 'Content-Type': 'application/json' }
                    });

                    alert('ë‹µì¥ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’Œ');
                    msgEl.value = '';
                } catch (e) {
                    alert('ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    replyReplyBtn.disabled = false; replyReplyBtn.textContent = 'ë‹µì¥ ë³´ë‚´ê¸°';
                }
            });

            // [ì •ìƒí™”] êµ¬ë… ìƒíƒœ ì²´í¬ (ë¹„ë™ê¸°ë¡œ ì‹¤í–‰í•˜ì—¬ UI ë§‰í˜ ë°©ì§€)
            checkSubscriptionStatus();
        });

        // êµ¬ë… ìƒíƒœ ì •ë°€ ì²´í¬ í•¨ìˆ˜ (ë³„ë„ ë¶„ë¦¬)
        async function checkSubscriptionStatus() {
            let isRelayActive = false;
            try {
                // SWê°€ ì—†ê±°ë‚˜ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì´ ì¤„ì—ì„œ ë©ˆì¶œ ìˆ˜ ìˆìœ¼ë¯€ë¡œ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ í•„ìš”
                // í•˜ì§€ë§Œ ê°„ë‹¨íˆ getRegistration()ìœ¼ë¡œ í™•ì¸
                const reg = await navigator.serviceWorker.getRegistration();
                if (reg) {
                    const sub = await reg.pushManager.getSubscription();
                    isRelayActive = !!sub;
                }
            } catch (e) { console.warn('[SW Check]', e); }

            const hasPermission = (Notification.permission === 'granted');
            const localSubscribed = localStorage.getItem('bona_subscribed') === 'true';

            // ì‹¤ì œ í†µë¡œê°€ ì‚´ì•„ìˆê³  ê¶Œí•œë„ ìˆëŠ” ê²½ìš°ì—ë§Œ 'ì™„ë£Œ'ë¡œ í‘œì‹œ
            if (isRelayActive && hasPermission) {
                const subBtns = ['cardSubBtn', 'mainSubBtn'];
                subBtns.forEach(id => {
                    const btn = document.getElementById(id);
                    if (btn) {
                        btn.textContent = 'êµ¬ë… ì™„ë£Œ';
                        btn.disabled = true;
                    }
                });
            } else {
                // ê¸°ë¡ì€ ìˆìœ¼ë‚˜ í†µë¡œê°€ ëŠê²¼ê±°ë‚˜ ê¶Œí•œì´ ì—†ëŠ” ê²½ìš° (ë¶ˆì¼ì¹˜ ìƒíƒœ)
                if (localSubscribed) {
                    localStorage.removeItem('bona_subscribed');
                }

                // ì•ˆë‚´ íŒì—… ë¡œì§
                const dismissedAt = localStorage.getItem('bona_modal_dismissed');
                const hoursSinceDismissed = dismissedAt ? (new Date() - new Date(dismissedAt)) / (1000 * 60 * 60) : 999;
                const isKakao = navigator.userAgent.includes('KAKAOTALK');

                if (hoursSinceDismissed > 72 && !isKakao) {
                    setTimeout(() => {
                        const modal = document.getElementById('landingModal');
                        if (modal) modal.classList.remove('hidden');
                    }, 60000);
                }
            }
        }
    </script>
</body>

</html>